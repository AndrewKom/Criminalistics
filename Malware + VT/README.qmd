---
title: "Malware + VT" 
format:   
  md:     
    output-file: README.md 
editor: visual 
---

# Статический анализ вредоносных программ

Были получены 4 подозрительных приложения, которые необходимо проанализировать и понять какую полезную нагрузку они могут в себя включать. Также в ходе работы будет затронута служба VirusTotal.

VirusTotal — бесплатная служба, осуществляющая анализ подозрительных файлов и ссылок (URL) на предмет выявления вирусов, червей, троянов и всевозможных вредоносных программ.

## Анализ программ

### Lab01-01.exe и Lab01-01.dll

По отчету с VirusTotal можно утверждать, что данные программы несут в себе полезную нагрузку, которая может угрожать устройству.

![](images/clipboard-561576199.png)

![](images/clipboard-1593406008.png)

Чтобы посмотреть даты компиляции программ можно использовать утилиту PEview. Для этого необходимо посмотреть значение поля TimeDateStamp в файловом заголовке IMAGE_FILE_HEADER.

![](images/clipboard-1962978108.png)

![](images/clipboard-1034475775.png)

С использованием утилиты PEiD выполним сканирование исполняемых файлов. Утилита PEiD обнаружила сигнатуру стандартного компилятора фирмы Microsoft, что говорит об отсутствии изменений возле точки входа в программу.

![](images/clipboard-2624006483.png)

![](images/clipboard-511911600.png)

Затем можно проверить поля размеров секции в памяти и на диске. Размеры секции кода на диске и в памяти практически одинаковые, что также говорит об отсутствии следов обфускации.

![](images/clipboard-2988566532.png)

Следующим шагом может стать проверка строк с исполняемых файлах. Для этого можно воспользоваться утилитой strings из пакета Malcode Analyst Pack. Строки в исполняемых файлах присутствуют в явном виде, что говорит об отсутствии следов обфускации или упаковки.

![](images/clipboard-3954760161.png)

Для анализа исполняемых функций можно воспользоваться утилитой Dependency Walker. Она показывает все используемые библиотеки и импортируемые из них функции. В первом файле присутствуют функции CopyFile, FindFirstFile, FindNextFile. Это говорит о том, что скорее всего программа ищет какой-то файл и затем копирует его. Во втором файле находятся функции CreateProcess, Sleep. Основываясь на этом, можно сделать вывод, что исследуемая DLL, скорее всего создаст новый процесс и на каком-то этапе заснет (приостановит выполнение). В DLL также присутствуют интересные импортируемые функции из библиотеки WS2_32.DLL, которые импортируются по порядковому номеру. К интересным функциям из библиотеки WS2_32.DLL можно отнести: closesocket, connect, htons, inet_addr, recv, send, shutdown, socket, WSAStartup, WSACleanup. Эти функции говорят о том, что программа выполняет интернет соединение и передает данные на удаленный IP-адрес.

![](images/clipboard-2583140843.png)

Внимательное изучение строк, содержащихся в файле Lab01-01.exe, показывает, что он ссылается на файл с именем C:\\windows\\system32\\kerne132.dll. В записи присутствует очень тонкая ошибка. Вместо латинской буквы l используется 1, из-за этого, вероятно, это программа является вредоносной, и можем использовать ее для поиска зараженных систем.

![](images/clipboard-3043782925.png)

Внимательное изучение строк, содержащихся в библиотеки Lab01-01.dll, отражает IP-адрес. С учетом импортируемых сетевых функций можно предположить, что файл связывается с этим IP-адресом. Этот признак можно использовать для поиска зараженных систем, которые связались с IP-адресом 127.26.152.13.

![](images/clipboard-164942172.png)

На основе проведенного
анализа можно предположить, что исполняемый файл Lab01-01.exe используется для
запуска библиотеки DLL (Lab01-01.dll), которая действует как бэкдор или троянская программа удаленного доступа (RAT). На основе импорта можно сказать, что исполняемый файл ищет, существует ли C:\\windows\\system32\\kerne132.dll, если ее нет, то он может попытаться скопировать вредоносную DLL в C:\\windows\\system32\\kerne132.dll, которая используется для закрепления в системе. После запуска, DLL (Lab01-01.dll), вероятно, связывается с C2-сервером по адресу 127.26.152.13.

### Lab01-02.exe

По отчету с VirusTotal можно утверждать, что данные программы несут в себе полезную нагрузку, которая может угрожать устройству.

![](images/clipboard-4110282701.png)

Зайдем в отчет VirusTotal, по его данным можно утверждать, что файл упакован, причем также можно определить, чем файл был упакован(UPX).

![](images/clipboard-321718995.png)

Также можно заметить, что виртуальный размер сильно не совпадает с физическим.

![](images/clipboard-1918914112.png)

Распакуем файл.

![](images/clipboard-1619960068.png)

Посмотрим уже распакованный
файл в VirusTotal, можно выделить интересные функции. На основании
этого мы можем сделать вывод, что исполняемый файл создает и запускает службу и что он подключается к Интернету.

![](images/clipboard-3724539430.png)

При просмотре файла можно
заметить службу, про которую мы узнали на прошлом шаге и ссылку. Исходя из
этого, мы можем предположить, что поиск хостов для запланированной службы под названием ‘malservice" и просмотр любых хостов, подключенных к
"http://www.malwareanalysisbook.com’, послужат надежными индикаторами
хоста и сети.

![](images/clipboard-3697023440.png)

### Lab01-03.exe

### Lab01-04.exe
